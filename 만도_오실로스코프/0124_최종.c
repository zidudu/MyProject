volatile int duty1 = 0; // 듀티 사이클 증가용

//시계가 있고, 시계들의 나침반이 돌아가는 속도가 있죠. 0부터 한바퀴 돌텐데
// 한바퀴를 돌때, 1초라는 개념으로 초마다 도는 거였는데, 이거를 1초라는 개념을 버리고
// 도는 속도를 조절하는 거지.

//=> 분주율로 이 속도를 조절하는 거야.
//기본 시계는 초당 1600만번(16MHz)인데 너무 빨라.
// 그래서 분주율로 해서 64배를 천천히 돌게 함
//16000000 / 64 = 250,000(초당 25만번)
void setup() {
  pinMode(11, OUTPUT); // 11번 핀을 출력으로 설정 12번 파랑 ch1
  pinMode(12, OUTPUT); // 12번 핀을 출력으로 설정 (10Hz 고정) 듀티50퍼 11번 노랑 ch2
  //12번 핀은 듀티 사이클을 50%로 고정할 예정이고, 11번 핀은 코드에서 점차 듀티 사이클을 변경합니다.
  // Timer1 설정
  //분주비 맞춤
  TCCR1A = (1 << COM1A1) | (1 << COM1B1) | (1 << WGM11); //com1a1=11 com1b1=12 활성화 비반전모드 wgm11=past pwm모드 
 
//WGM13와 WGM12, 그리고 WGM11 비트 세팅이 Fast PWM 모드 중에서 ICR1을 TOP 값으로 사용하는 모드를 의미합니다.
//이렇게 설정하면 ICR1 레지스터가 PWM의 최대 카운트값(TOP)이 됩니다.
//즉, OCR1A, OCR1B 값에 따라 듀티 사이클이 결정되는 일반적인(가장 많이 쓰는) PWM 출력 방식이에요.
  TCCR1B = (1 << WGM13) | (1 << WGM12) | (1 << CS11) | (1 << CS10); //  CS10=분주율 64,WGM13,WGM12= Fast PWM 모드
  //헤르츠 설정(최대치 설정)
  ICR1 = 24999; // TOP 값 설정 (10Hz) 25000=16mhz/분주율x주파수 
//즉, 0부터 24999까지 숫자를 세면 다시 0으로 돌아가는 거야.
//이걸 “하나의 주기(cycle)”라고 해.

0.1초 * 25000번 을 세다가 끝남. 10번하게 됨.  10번 * 0.1초 * 25000 = 250000번이 됨.
이렇게 되면 1초에 10번 작동한다. 
//이렇게 분주율을 64로 낮추고, 최댓값(ICR1)을 24999로 잡으면,
//1초에 정확히 10번(10Hz)씩 0부터 24999까지 세고 리셋하는 과정이 일어나.

  //듀티사이클 설정
  OCR1A = 0; // 11번 핀 초기 듀티 사이클 0%
  OCR1B = ICR1/2; // 10번 핀 듀티 사이클 고정 (50%) // 12499
  
  //노랑 11번 핀으로 연결되어있는데 이거에 Timer0을 설정함.
  //
  // Timer0 설정 (5ms 간격 인터럽트 생성)

  
  TCCR0A = (1 << WGM01); // CTC 모드 timer0이
  TCCR0B = (1 << CS01) | (1 << CS00); // 분주율 64
  //5ms 마다 인터럽트 실행하기 위해 설정
  OCR0A = 1249; // 5ms 주기 (16MHz / 64 / 1250)
  TIMSK0 = (1 << OCIE0A); // Timer0 비교 일치 인터럽트 활성화

  sei(); // 글로벌 인터럽트 활성화
//모든 인터럽트를 허용(Enable)해줘야 실제로 Timer0의 비교 일치 인터럽트가 동작합니다.

}

ISR(TIMER0_COMPA_vect) {
  // 11번 핀의 듀티 사이클을 점진적으로 증가
  if (duty1 <= ICR1) {
    OCR1A = duty1; //11번 핀의 PWM 듀티 사이클이 점진적으로 커짐.
    duty1 += 1; // 듀티 사이클 증가 속도
  } else {
    duty1 = 0; // 다시 0으로 초기화
  }
}
//PWM 신호가 1초에 10번 반복(주기 0.1초)”된다는 뜻
//ISR(TIMER0_COMPA_vect)**는 5ms마다(0.005초마다) 실행
//즉, ISR(TIMER0_COMPA_vect)는 1초에 200번(1/0.005초) 실행됩니다.
//이 ISR 안에서 duty1 값을 1씩 증가시키며, OCR1A에 반영해서 11번 핀 듀티 사이클을 천천히 바꿉니다.
//정리하면, **“10Hz”**는 Timer1이 만드는 PWM 파형의 반복 주기(0.1초),
//**“5ms(200Hz)”**는 Timer0 인터럽트가 실행되는 주기(0.005초)입니다.
void loop() {
  // 메인 루프는 비어 있음. PWM 신호는 인터럽트에 의해 제어됩니다.
}
